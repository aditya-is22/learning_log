{% extends "learning_logs/base.html" %}

{% block page_header %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-list-ul me-2"></i>Your Topics</h1>

    <form class="d-flex" style="width: 40%;" action="{% url 'learning_logs:search_results' %}" method="get">
      <input class="form-control me-2" type="search" name="q" placeholder="Search Topics or Entries" aria-label="Search">
      <button class="btn btn-primary" type="submit"><i class="fas fa-search me-1"></i> Search</button>
    </form>
  </div>
{% endblock page_header %}

{% block content %}
  {% csrf_token %}
  <div class="mb-4">
    <a href="{% url 'learning_logs:new_topic' %}" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Add New Topic</a>
  </div>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for topic in topics %}
      <div class="col">
        <div class="card h-100 topic-item">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h3 class="card-title h5 mb-3">
                <a href="{% url 'learning_logs:topic' topic.id %}">{{ topic }}</a>
              </h3>
              <div class="btn-group" role="group">
                <a href="{% url 'learning_logs:new_entry' topic.id %}" class="btn btn-sm btn-outline-success" title="Add new entry">
                  <i class="fas fa-plus"></i>
                </a>
                <div class="export-dropdown btn-group">
                  <button class="btn btn-sm btn-outline-info export-btn" type="button" title="Export topic">
                    <i class="fas fa-download"></i>
                  </button>
                  <div class="export-dropdown-content">
                    <a href="{% url 'learning_logs:export_topic_entries' topic.id 'pdf' %}" class="export-option pdf">
                      <i class="fas fa-file-pdf"></i> PDF
                    </a>
                    <a href="{% url 'learning_logs:export_topic_entries' topic.id 'docx' %}" class="export-option docx">
                      <i class="fas fa-file-word"></i> Word
                    </a>
                    <a href="{% url 'learning_logs:export_topic_entries' topic.id 'json' %}" class="export-option json">
                      <i class="fas fa-file-code"></i> JSON
                    </a>
                    <a href="{% url 'learning_logs:export_topic_entries' topic.id 'csv' %}" class="export-option csv">
                      <i class="fas fa-file-csv"></i> CSV
                    </a>
                  </div>
                </div>
                <button class="btn btn-sm btn-outline-danger delete-btn" 
                        data-message="Are you sure you want to delete this topic? All entries associated with this topic will be deleted."
                        data-url="{% url 'learning_logs:delete_topic' topic.id %}"
                        title="Delete topic">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <p class="card-text text-muted small">Created: {{ topic.date_added|date:'M d, Y' }}</p>
          </div>
          <div class="card-footer bg-transparent border-top-0 text-end">
            <a href="{% url 'learning_logs:topic' topic.id %}" class="btn btn-sm btn-outline-primary"><i class="fas fa-eye me-1"></i> View Entries</a>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info" role="alert">
          <i class="fas fa-info-circle me-2"></i> No topics have been added yet. Create your first topic to get started!
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock content %}